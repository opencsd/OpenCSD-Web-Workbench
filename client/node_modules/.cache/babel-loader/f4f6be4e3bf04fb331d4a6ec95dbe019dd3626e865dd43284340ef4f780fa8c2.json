{"ast":null,"code":"\"use strict\";\n\nvar clear = require(\"es5-ext/array/#/clear\"),\n  assign = require(\"es5-ext/object/assign\"),\n  callable = require(\"es5-ext/object/valid-callable\"),\n  value = require(\"es5-ext/object/valid-value\"),\n  d = require(\"d\"),\n  autoBind = require(\"d/auto-bind\"),\n  Symbol = require(\"es6-symbol\");\nvar defineProperty = Object.defineProperty,\n  defineProperties = Object.defineProperties,\n  _Iterator;\nmodule.exports = _Iterator = function Iterator(list, context) {\n  if (!(this instanceof _Iterator)) throw new TypeError(\"Constructor requires 'new'\");\n  defineProperties(this, {\n    __list__: d(\"w\", value(list)),\n    __context__: d(\"w\", context),\n    __nextIndex__: d(\"w\", 0)\n  });\n  if (!context) return;\n  callable(context.on);\n  context.on(\"_add\", this._onAdd);\n  context.on(\"_delete\", this._onDelete);\n  context.on(\"_clear\", this._onClear);\n};\n\n// Internal %IteratorPrototype% doesn't expose its constructor\ndelete _Iterator.prototype.constructor;\ndefineProperties(_Iterator.prototype, assign({\n  _next: d(function () {\n    var i;\n    if (!this.__list__) return undefined;\n    if (this.__redo__) {\n      i = this.__redo__.shift();\n      if (i !== undefined) return i;\n    }\n    if (this.__nextIndex__ < this.__list__.length) return this.__nextIndex__++;\n    this._unBind();\n    return undefined;\n  }),\n  next: d(function () {\n    return this._createResult(this._next());\n  }),\n  _createResult: d(function (i) {\n    if (i === undefined) return {\n      done: true,\n      value: undefined\n    };\n    return {\n      done: false,\n      value: this._resolve(i)\n    };\n  }),\n  _resolve: d(function (i) {\n    return this.__list__[i];\n  }),\n  _unBind: d(function () {\n    this.__list__ = null;\n    delete this.__redo__;\n    if (!this.__context__) return;\n    this.__context__.off(\"_add\", this._onAdd);\n    this.__context__.off(\"_delete\", this._onDelete);\n    this.__context__.off(\"_clear\", this._onClear);\n    this.__context__ = null;\n  }),\n  toString: d(function () {\n    return \"[object \" + (this[Symbol.toStringTag] || \"Object\") + \"]\";\n  })\n}, autoBind({\n  _onAdd: d(function (index) {\n    if (index >= this.__nextIndex__) return;\n    ++this.__nextIndex__;\n    if (!this.__redo__) {\n      defineProperty(this, \"__redo__\", d(\"c\", [index]));\n      return;\n    }\n    this.__redo__.forEach(function (redo, i) {\n      if (redo >= index) this.__redo__[i] = ++redo;\n    }, this);\n    this.__redo__.push(index);\n  }),\n  _onDelete: d(function (index) {\n    var i;\n    if (index >= this.__nextIndex__) return;\n    --this.__nextIndex__;\n    if (!this.__redo__) return;\n    i = this.__redo__.indexOf(index);\n    if (i !== -1) this.__redo__.splice(i, 1);\n    this.__redo__.forEach(function (redo, j) {\n      if (redo > index) this.__redo__[j] = --redo;\n    }, this);\n  }),\n  _onClear: d(function () {\n    if (this.__redo__) clear.call(this.__redo__);\n    this.__nextIndex__ = 0;\n  })\n})));\ndefineProperty(_Iterator.prototype, Symbol.iterator, d(function () {\n  return this;\n}));","map":null,"metadata":{},"sourceType":"script","externalDependencies":[]}